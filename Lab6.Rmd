---
title: "Lab6"
author: "Anna Matarazzo"
date: "10/11/2020"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r}

library (dplyr)

a <- c(1,2,3,4,5)
sample(a)

a1 <- factorial(last(a))
a1
```  
  
  
```{r}
group_A <- rnorm(50,65,10)
group_B <- rnorm(50,65,10)


mean(group_A)
mean(group_B)

```


  
```{r}
a <- sample(x = 0:9, size = 7, replace = FALSE)
samples <- replicate(100000, sample(a))

count_example <- 0
for(i in 1:100000){
  if(sum (samples[,i] == c(8,6,7,5,3,0,9)) == 7) {
    count_example <-  count_example+1
  }
}

count_example
count_example/100000 

```

```{r}

samples <- replicate(100000, sample(c(0,3,5,6,7,8,9)))

count_example <- 0
for(i in 1:100000){
  if(sum (samples[,i] == c(8,6,7,5,3,0,9)) == 7) {
    count_example <-  count_example+1
  }
}

count_example
count_example/100000 

```


```{r}
example_outcome <- data.frame(group = rep(c("A","B"),each=4),
                              person = c(1:4,1:4),
                              ball = sample(1:8)
                              )
knitr::kable(example_outcome)

library(combinat)
permutation_matrix <- matrix(unlist(permn(1:8)), ncol=8, byrow=TRUE)


group_A_sums <- rowSums(permutation_matrix[,1:4])
group_B_sums <- rowSums(permutation_matrix[,5:8])

possible_differences <- group_A_sums - group_B_sums 

hist(possible_differences)

max(possible_differences)

length(possible_differences[possible_differences >15])

absolute_differences <- abs(possible_differences)
length(absolute_differences[absolute_differences > 10])/length(absolute_differences)

```

```{r}
group_A <- c(85,75,76,89)
group_B <- c(90,65,68,69)

mean(group_A)
mean(group_B)

mean(group_A) - mean(group_B)

all_scores <- c(group_A, group_B)
permutation_matrix <- matrix(unlist(permn(all_scores)), ncol = 8, byrow = TRUE)

group_A_means <- rowSums(permutation_matrix[,1:4])/4
group_B_means <- rowSums(permutation_matrix[,5:8])/4

possible_differences <- group_A_means - group_B_means

library(ggplot2)

qplot(possible_differences)+
  geom_histogram(color="orange")+
  geom_vline(xintercept=mean(group_A) - mean(group_B), color = "red")+
  theme_classic()

length(possible_differences[possible_differences >= 8.25])/length(possible_differences)

```



```{r}

group_A <- rnorm(50,65,10)
group_B <- rnorm(50,65,10)

mean(group_A)
mean(group_B)
mean(group_A) - mean(group_B)

all_scores <- c(group_A, group_B)
resample <- sample(all_scores)
new_A_mean <- mean(resample[1:50])
new_B_mean <- mean(resample[51:100])
new_difference <- new_A_mean - new_B_mean

mean_differences <- c()
for (i in 1:10000){
  resample <- sample(all_scores)
new_A_mean <- mean(resample[1:50])
new_B_mean <- mean(resample[51:100])
mean_differences[i] <- new_A_mean - new_B_mean
}

qplot(mean_differences)+
  geom_histogram(color="orange")+
  geom_vline(xintercept=mean(group_A) - mean(group_B), color = "red")+
  theme_classic()


```



```{r}
the_data <- read.csv("open_data/SchroederEpley2015data.csv", header = TRUE)

library(dplyr)

the_data %>%
  group_by(CONDITION) %>%
  summarize(group_means = mean(Intellect_Rating))

simulation_data <- the_data %>%
  select(CONDITION, Intellect_Rating)

simulation_data %>%
  mutate(Intellect_Rating = sample(Intellect_Rating))

new_data <- simulation_data %>%
   mutate(Intellect_Rating = sample(Intellect_Rating)) %>%
  group_by(CONDITION) %>%
  summarize(new_means = mean(Intellect_Rating), .groups="drop")

new_data
new_data[new_data$CONDITION == 0,]$new_means
new_data[new_data$CONDITION == 1,]$new_means
new_difference <- new_data[new_data$CONDITION == 1,]$new_means-new_data[new_data$CONDITION == 0,]$new_means

possible_differences <- c()
for(i in 1:1000){
  new_data <- simulation_data %>%
   mutate(Intellect_Rating = sample(Intellect_Rating)) %>%
  group_by(CONDITION) %>%
  summarize(new_means = mean(Intellect_Rating), .groups="drop")

possible_differences[i] <- new_data[new_data$CONDITION == 1,]$new_means-new_data[new_data$CONDITION == 0,]$new_means
}


qplot(possible_differences)+
  geom_histogram(color="orange")+
  geom_vline(xintercept=2, color = "red")+
  theme_classic()

length(possible_differences[possible_differences >= 2])/length(possible_differences)

```

```{r}
the_data <- read.csv("open_data/SchroederEpley2015data.csv", header = TRUE)

the_data %>%
  group_by(CONDITION) %>%
  summarize(group_means = mean(Intellect_Rating))

table(the_data$CONDITION)

mean_differences <- c()
for(i in 1:10000){
  resample <- sample(the_data$Intellect_Rating)
  new_1_mean <- mean(resample[1:18])
  new_0_mean <- mean(resample[10:39])
  mean_differences[i] <- new_1_mean - new_0_mean

}


qplot(mean_differences)+
  geom_histogram(color="orange")+
  geom_vline(xintercept=2, color = "red")+
  theme_classic()



```



## Problem 1

1. Write a function that conducts a randomization test for the mean difference between two groups, and show that it works. Specifically, using your function, conduct a randomization test on the same data we used in the above example from lab. Report the results and briefly discuss what the results of the randomization tell you. (6 points). Extra: if the observed mean difference in the experiment was found to be .5, what would you have concluded from the randomization test?

Inputs:
- the inputs should include a vector for group 1, and vector for group 2, and the number of permutations/re-samplings of the data to create.

Outputs:
- output each group mean, and the difference between group means
- output a histogram of the sampling distribution of the possible mean differences produced by the randomization process
- output the probability or odds of obtaining the observed mean difference or larger.

Optional:

- include the ability to calculate the probability of obtaining any mean difference or larger
- deal with negative difference scores appropriately
- 
add one or two-tailed test options

```{r}
group_one <- c(3,4,5,6,7)
group_two <- c(5,3,2,4,6)
  
randomization_test <- function(A, B, resamples = 100) {
  
  group_A_mean <- mean(A)
  group_B_mean <- mean(B)
  mean_difference <- group_A_mean - group_B_mean
  
 all_means <- c(A,B) 
 
 possible_differences <- c()
 for(i in 1:resamples){
  resample <- sample(all_means)
  new_A_mean <- mean(resample[1:length(A)])
  new_B_mean <- mean(resample[(length(A)+1):length(all_means)])
  possible_differences[i] <- new_A_mean - new_B_mean

}
 
 the_plot <- ggplot2::qplot(possible_differences)+
  ggplot2::geom_histogram(color="orange")+
  ggplot2::geom_vline(xintercept=mean_difference, color = "red")+
  ggplot2::theme_classic()

  probability <- length(possible_differences[possible_differences >= mean_difference ] )/resamples

 
 test_output <- list(A_mean = group_A_mean,
                     B_mean = group_B_mean,
                     difference = mean_difference,
                     randomization = possible_differences,
                     plot = the_plot)
 
 return(test_output)
}

randomization_test(A = group_one, B = group_two, resamples = 100)

```







